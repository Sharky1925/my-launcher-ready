{% extends "admin/base.html" %}
{% block page_title %}Dashboard{% endblock %}
{% block content %}
<div class="row g-4 mb-4">
  <div class="col-md-4 col-sm-6">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon bg-primary bg-opacity-10 text-primary me-3"><i class="fa-solid fa-gear"></i></div>
        <div><div class="fw-bold fs-4">{{ stats.services }}</div><div class="text-muted small">Services</div></div>
      </div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon bg-success bg-opacity-10 text-success me-3"><i class="fa-solid fa-newspaper"></i></div>
        <div><div class="fw-bold fs-4">{{ stats.posts }}</div><div class="text-muted small">Blog Posts</div></div>
      </div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon bg-warning bg-opacity-10 text-warning me-3"><i class="fa-solid fa-envelope"></i></div>
        <div><div class="fw-bold fs-4">{{ stats.contacts }}</div><div class="text-muted small">Unread Messages</div></div>
      </div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon bg-info bg-opacity-10 text-info me-3"><i class="fa-solid fa-users"></i></div>
        <div><div class="fw-bold fs-4">{{ stats.team }}</div><div class="text-muted small">Team Members</div></div>
      </div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon bg-danger bg-opacity-10 text-danger me-3"><i class="fa-solid fa-quote-right"></i></div>
        <div><div class="fw-bold fs-4">{{ stats.testimonials }}</div><div class="text-muted small">Testimonials</div></div>
      </div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon bg-secondary bg-opacity-10 text-secondary me-3"><i class="fa-solid fa-photo-film"></i></div>
        <div><div class="fw-bold fs-4">{{ stats.media }}</div><div class="text-muted small">Media Files</div></div>
      </div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon bg-danger bg-opacity-10 text-danger me-3"><i class="fa-solid fa-ticket"></i></div>
        <div><div class="fw-bold fs-4">{{ stats.support_tickets }}</div><div class="text-muted small">Open Support Tickets</div></div>
      </div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <div class="card stat-card">
      <div class="card-body d-flex align-items-center">
        <div class="icon bg-primary bg-opacity-10 text-primary me-3"><i class="fa-solid fa-user-shield"></i></div>
        <div><div class="fw-bold fs-4">{{ stats.support_clients }}</div><div class="text-muted small">Support Clients</div></div>
      </div>
    </div>
  </div>
  <div class="col-md-4 col-sm-6">
    <a href="{{ url_for('admin.security_events') }}" class="text-decoration-none">
      <div class="card stat-card">
        <div class="card-body d-flex align-items-center">
          <div class="icon bg-warning bg-opacity-10 text-warning me-3"><i class="fa-solid fa-shield-halved"></i></div>
          <div><div class="fw-bold fs-4">{{ stats.security_events_24h }}</div><div class="text-muted small">Security Events (24h)</div></div>
        </div>
      </div>
    </a>
  </div>
</div>

<div class="card border-0 shadow-sm">
  <div class="card-header bg-white"><h6 class="mb-0">Recent Contact Submissions</h6></div>
  <div class="card-body p-0">
    <table class="table table-hover mb-0">
      <thead><tr><th>Name</th><th>Subject</th><th>Date</th><th>Status</th></tr></thead>
      <tbody>
        {% for c in recent_contacts %}
        <tr>
          <td><a href="{{ url_for('admin.contact_view', id=c.id) }}" class="text-decoration-none">{{ c.name }}</a></td>
          <td>{{ c.subject or 'No subject' }}</td>
          <td>{{ c.created_at.strftime('%b %d, %Y') }}</td>
          <td>{% if c.is_read %}<span class="badge bg-secondary">Read</span>{% else %}<span class="badge bg-primary">New</span>{% endif %}</td>
        </tr>
        {% else %}
        <tr><td colspan="4" class="text-center text-muted py-3">No submissions yet</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="card border-0 shadow-sm mt-4">
  <div class="card-header bg-white d-flex justify-content-between align-items-center">
    <h6 class="mb-0">Recent Support Tickets</h6>
    <a href="{{ url_for('admin.support_tickets') }}" class="btn btn-sm btn-outline-primary">Manage Tickets</a>
  </div>
  <div class="card-body p-0">
    <table class="table table-hover mb-0">
      <thead><tr><th>Ticket</th><th>Client</th><th>Subject</th><th>Type</th><th>Status</th><th>Updated</th></tr></thead>
      <tbody>
        {% for t in recent_tickets %}
        <tr>
          <td><a href="{{ url_for('admin.support_ticket_view', id=t.id) }}" class="text-decoration-none"><code>{{ t.ticket_number }}</code></a></td>
          <td>{{ t.client.full_name }}</td>
          <td>{{ t.subject }}</td>
          <td>
            {% if is_quote_ticket(t) %}
            <span class="badge rounded-pill bg-info text-dark">Quote</span>
            {% else %}
            <span class="badge rounded-pill bg-secondary">Support</span>
            {% endif %}
          </td>
          <td>
            {% if t.status == 'open' %}
            <span class="badge bg-primary">Open</span>
            {% elif t.status == 'in_progress' %}
            <span class="badge bg-warning text-dark">In Progress</span>
            {% elif t.status == 'waiting_customer' %}
            <span class="badge bg-secondary">Waiting Client</span>
            {% elif t.status == 'resolved' %}
            <span class="badge bg-success">Resolved</span>
            {% else %}
            <span class="badge bg-dark">Closed</span>
            {% endif %}
          </td>
          <td>{{ t.updated_at.strftime('%b %d, %Y') }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-center text-muted py-3">No support tickets yet</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
