{% extends "base.html" %}
{% set profile = service_profile or {} %}
{% set service_description = (service.description or '') %}
{% set fallback_desc = (service_description[:155] if service_description else (service.title ~ ' service support for Orange County businesses.')) %}
{% set meta_desc = profile.get('meta_description', fallback_desc) %}
{% set profile_keywords = profile.get('keywords', [service.title ~ ' Orange County', service.title ~ ' service', 'business IT support']) %}
{% set process_steps = profile.get('process', []) %}
{% set tool_stack = profile.get('tools', []) %}
{% set deliverables = profile.get('deliverables', []) %}
{% set faqs = profile.get('faqs', []) %}

{% block title %}{{ service.title }} — {{ site_settings.get('company_name', 'Right On Repair') }}{% endblock %}
{% block meta_description %}{{ meta_desc }}{% endblock %}
{% block og_title %}{{ service.title }} — {{ site_settings.get('company_name', 'Right On Repair') }}{% endblock %}
{% block og_description %}{{ meta_desc }}{% endblock %}
{% block meta_keywords %}{{ profile_keywords | join(', ') }}{% endblock %}

{% block structured_data %}
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Service",
  "name": {{ service.title | tojson }},
  "description": {{ meta_desc | tojson }},
  "serviceType": {{ service.service_type | tojson }},
  "areaServed": "Orange County, CA",
  "provider": {
    "@type": "Organization",
    "name": {{ site_settings.get('company_name', 'Right On Repair') | tojson }},
    "telephone": {{ site_settings.get('phone', '') | tojson }},
    "email": {{ site_settings.get('email', '') | tojson }}
  },
  "url": {{ request.base_url | tojson }}
}
</script>
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ url_for('main.index', _external=True) | tojson }}
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Services",
      "item": {{ url_for('main.services', _external=True) | tojson }}
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": {{ service.title | tojson }},
      "item": {{ request.base_url | tojson }}
    }
  ]
}
</script>
{% if process_steps %}
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": {{ (service.title ~ ' Workflow') | tojson }},
  "description": {{ ('Step-by-step process used for ' ~ service.title) | tojson }},
  "step": [
    {% for step in process_steps %}
    {
      "@type": "HowToStep",
      "position": {{ loop.index }},
      "name": {{ step.title | tojson }},
      "text": {{ step.detail | tojson }}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}
{% if faqs %}
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for faq in faqs %}
    {
      "@type": "Question",
      "name": {{ faq.q | tojson }},
      "acceptedAnswer": {
        "@type": "Answer",
        "text": {{ faq.a | tojson }}
      }
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}
{% endblock %}

{% block content %}
<!-- Hero -->
<section class="page-header section-bottom-spacious">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('main.services') }}">Services</a></li>
        <li class="breadcrumb-item active">{{ service.title }}</li>
      </ol>
    </nav>
    <div class="row align-items-center g-5">
      <div class="col-lg-7 reveal-left">
        <div class="ind-hero-icon"><i class="{{ service.icon_class }}"></i></div>
        <h1>{{ service.title }} <span class="gradient-text">{{ profile.get('intro_kicker', 'Solutions') }}</span></h1>
        <p class="industry-hero-description">{{ meta_desc }}</p>
        <div class="hero-buttons industry-hero-actions">
          <a href="{{ url_for('main.remote_support') }}" class="btn btn-primary">Remote Support <i class="fa-solid fa-life-ring"></i></a>
          <a href="{{ url_for('main.request_quote') }}" class="btn btn-ghost">Request Quote <i class="fa-solid fa-file-invoice-dollar"></i></a>
        </div>
      </div>
      <div class="col-lg-5 reveal-right">
        {% if deliverables %}
        {% set mc_colors = ['blue', 'purple', 'green', 'amber', 'rose', 'cyan'] %}
        <div class="row g-3">
          {% for outcome in deliverables %}
          <div class="col-6">
            <div class="metric-card">
              <div class="mc-icon {{ mc_colors[(loop.index0) % 6] }}"><i class="{{ outcome.icon }}"></i></div>
              <div class="mc-value">{{ outcome.value }}</div>
              <div class="mc-label">{{ outcome.label }}</div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<div class="glow-line"></div>

<!-- How It Works -->
{% if process_steps %}
<section class="section">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-diagram-project"></i> How It Works</div>
      <h2>{{ profile.get('board_title', 'Service Workflow') }}</h2>
    </div>
    <div class="row g-4 justify-content-center">
      {% set step_colors = ['blue', 'purple', 'amber', 'green', 'rose', 'cyan'] %}
      {% for step in process_steps %}
      <div class="col-md-6 col-lg-4">
        <div class="challenge-card reveal stagger-{{ loop.index }}">
          <div class="ch-icon {{ step_colors[(loop.index0) % 6] }}"><i class="{{ step.icon }}"></i></div>
          <div class="ch-body">
            <h4>{{ step.title }}</h4>
            <p>{{ step.detail }}</p>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<div class="glow-line"></div>

<!-- Tools & Platforms -->
{% if tool_stack %}
<section class="section section--alt">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-layer-group"></i> Tools &amp; Platforms</div>
      <h2>Technology We Use</h2>
    </div>
    <div class="row g-4">
      {% set tool_colors = ['blue', 'purple', 'green', 'amber', 'rose', 'cyan'] %}
      {% for tool in tool_stack %}
      <div class="col-md-6">
        <div class="feature-item reveal stagger-{{ loop.index }}">
          <div class="fi-icon {{ tool_colors[(loop.index0) % 6] }}"><i class="{{ tool.icon }}"></i></div>
          <div>
            <h4>{{ tool.name }}</h4>
            {% if tool.desc %}<p>{{ tool.desc }}</p>{% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<!-- FAQ -->
{% if faqs %}
<section class="section">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-circle-question"></i> FAQ</div>
      <h2>Frequently Asked Questions</h2>
    </div>
    <div class="service-faq-list reveal">
      {% for faq in faqs %}
      <details class="service-faq-item" {% if loop.first %}open{% endif %}>
        <summary>{{ faq.q }}</summary>
        <p>{{ faq.a }}</p>
      </details>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<!-- CTA -->
<section class="section-sm section-bottom-spacious">
  <div class="cta-section reveal-scale">
    <div class="cta-inner">
      <h2>Remote Support or Request a Quote</h2>
      <p>Get live assistance or a scoped estimate for {{ service.title | lower }}.</p>
      <div class="cta-actions cta-actions-dual">
        <a href="{{ url_for('main.remote_support') }}" class="btn btn-remote-support"><i class="fa-solid fa-life-ring"></i> Remote Support</a>
        <a href="{{ url_for('main.request_quote') }}" class="btn btn-quote"><i class="fa-solid fa-file-invoice-dollar"></i> Request Quote</a>
      </div>
    </div>
  </div>
</section>
{% endblock %}
