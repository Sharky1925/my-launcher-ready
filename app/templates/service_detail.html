{% extends "base.html" %}
{% set profile = service_profile or {} %}
{% set service_description = (service.description or '') %}
{% set fallback_desc = (service_description[:155] if service_description else (service.title ~ ' service support for Orange County businesses.')) %}
{% set meta_desc = profile.get('meta_description', fallback_desc) %}
{% set profile_keywords = profile.get('keywords', [service.title ~ ' Orange County', service.title ~ ' service', 'business IT support']) %}
{% set process_steps = profile.get('process', []) %}
{% set tool_stack = profile.get('tools', []) %}
{% set deliverables = profile.get('deliverables', []) %}
{% set faqs = profile.get('faqs', []) %}
{% set local_cities = profile.get('service_area_cities', []) %}
{% set compliance_frameworks = profile.get('compliance_frameworks', []) %}
{% set proof_points = profile.get('proof_points', []) %}
{% set related_services = related_services or [] %}
{% set featured_industries = featured_industries or [] %}
{% set related_posts = related_posts or [] %}

{% block title %}{{ service.title }} — {{ site_settings.get('company_name', 'Right On Repair') }}{% endblock %}
{% block meta_description %}{{ meta_desc }}{% endblock %}
{% block og_title %}{{ service.title }} — {{ site_settings.get('company_name', 'Right On Repair') }}{% endblock %}
{% block og_description %}{{ meta_desc }}{% endblock %}
{% block meta_keywords %}{{ profile_keywords | join(', ') }}{% endblock %}

{% block structured_data %}
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Service",
  "name": {{ service.title | tojson }},
  "description": {{ meta_desc | tojson }},
  "serviceType": {{ service.service_type | tojson }},
  "url": {{ request.base_url | tojson }},
  "provider": {
    "@type": "Organization",
    "name": {{ site_settings.get('company_name', 'Right On Repair') | tojson }},
    "telephone": {{ site_settings.get('phone', '') | tojson }},
    "email": {{ site_settings.get('email', '') | tojson }}
  },
  "areaServed": [
    {% if local_cities %}
    {% for city in local_cities %}
    { "@type": "City", "name": {{ (city ~ ', CA') | tojson }} }{% if not loop.last %},{% endif %}
    {% endfor %}
    {% else %}
    { "@type": "AdministrativeArea", "name": "Orange County, CA" }
    {% endif %}
  ],
  "availableChannel": {
    "@type": "ServiceChannel",
    "serviceUrl": {{ request.base_url | tojson }},
    "availableLanguage": ["en"],
    "servicePhone": {
      "@type": "ContactPoint",
      "contactType": "sales",
      "telephone": {{ site_settings.get('phone', '') | tojson }}
    }
  }{% if process_steps %},
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "name": {{ (service.title ~ ' Service Scope') | tojson }},
    "itemListElement": [
      {% for step in process_steps %}
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": {{ step.title | tojson }},
          "description": {{ step.detail | tojson }}
        }
      }{% if not loop.last %},{% endif %}
      {% endfor %}
    ]
  }{% endif %}
}
</script>
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": {{ (service.title ~ ' | ' ~ site_settings.get('company_name', 'Right On Repair')) | tojson }},
  "description": {{ meta_desc | tojson }},
  "url": {{ request.base_url | tojson }},
  "about": {
    "@type": "Service",
    "name": {{ service.title | tojson }}
  },
  "isPartOf": {
    "@type": "WebSite",
    "name": {{ site_settings.get('company_name', 'Right On Repair') | tojson }},
    "url": {{ url_for('main.index', _external=True) | tojson }}
  }
}
</script>
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ url_for('main.index', _external=True) | tojson }}
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Services",
      "item": {{ url_for('main.services', _external=True) | tojson }}
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": {{ service.title | tojson }},
      "item": {{ request.base_url | tojson }}
    }
  ]
}
</script>
{% if process_steps %}
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": {{ (service.title ~ ' Workflow') | tojson }},
  "description": {{ ('Step-by-step process used for ' ~ service.title) | tojson }},
  "step": [
    {% for step in process_steps %}
    {
      "@type": "HowToStep",
      "position": {{ loop.index }},
      "name": {{ step.title | tojson }},
      "text": {{ step.detail | tojson }}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}
{% if related_services %}
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": {{ ('Related services for ' ~ service.title) | tojson }},
  "itemListElement": [
    {% for rel in related_services %}
    {
      "@type": "ListItem",
      "position": {{ loop.index }},
      "name": {{ rel.title | tojson }},
      "url": {{ url_for('main.service_detail', slug=rel.slug, _external=True) | tojson }}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}
{% if faqs %}
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for faq in faqs %}
    {
      "@type": "Question",
      "name": {{ faq.q | tojson }},
      "acceptedAnswer": {
        "@type": "Answer",
        "text": {{ faq.a | tojson }}
      }
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}
{% endblock %}

{% block content %}
<section class="page-header section-bottom-spacious">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('main.services') }}">Services</a></li>
        <li class="breadcrumb-item active">{{ service.title }}</li>
      </ol>
    </nav>
    <div class="row align-items-center g-5">
      <div class="col-lg-7 reveal-left">
        <div class="ind-hero-icon"><i class="{{ service.icon_class }}"></i></div>
        <h1>{{ service.title }} <span class="gradient-text">{{ profile.get('intro_kicker', 'Solutions') }}</span></h1>
        <p class="industry-hero-description">{{ meta_desc }}</p>
        <div class="hero-buttons industry-hero-actions">
          <a href="{{ url_for('main.request_quote') }}" class="btn btn-primary">Free IT Assessment <i class="fa-solid fa-magnifying-glass-chart"></i></a>
          <a href="{{ url_for('main.remote_support') }}" class="btn btn-ghost">Remote Support <i class="fa-solid fa-life-ring"></i></a>
        </div>
      </div>
      <div class="col-lg-5 reveal-right">
        {% if deliverables %}
        {% set mc_colors = ['blue', 'purple', 'green', 'amber', 'rose', 'cyan'] %}
        <div class="row g-3">
          {% for outcome in deliverables %}
          <div class="col-6">
            <div class="metric-card">
              <div class="mc-icon {{ mc_colors[(loop.index0) % 6] }}"><i class="{{ outcome.icon }}"></i></div>
              <div class="mc-value">{{ outcome.value }}</div>
              <div class="mc-label">{{ outcome.label }}</div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<div class="glow-line"></div>

{% if process_steps %}
<section class="section">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-diagram-project"></i> How It Works</div>
      <h2>{{ profile.get('board_title', 'Service Workflow') }}</h2>
    </div>
    <div class="row g-4 justify-content-center">
      {% set step_colors = ['blue', 'purple', 'amber', 'green', 'rose', 'cyan'] %}
      {% for step in process_steps %}
      <div class="col-md-6 col-lg-4">
        <div class="challenge-card reveal stagger-{{ loop.index }}">
          <div class="ch-icon {{ step_colors[(loop.index0) % 6] }}"><i class="{{ step.icon }}"></i></div>
          <div class="ch-body">
            <h4>{{ step.title }}</h4>
            <p>{{ step.detail }}</p>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<div class="glow-line"></div>

{% if local_cities or compliance_frameworks or proof_points %}
<section class="section section--alt">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-location-dot"></i> Local Coverage &amp; Trust</div>
      <h2>Operational Readiness Across Orange County</h2>
    </div>
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="service-visual-panel h-100 reveal-left">
          <div class="service-panel-head">
            <h2><i class="fa-solid fa-map-location-dot"></i> Cities We Serve</h2>
            <p>Field and remote support coverage for organizations across Orange County.</p>
          </div>
          {% if local_cities %}
          <div class="service-tool-cloud">
            {% for city in local_cities %}
            <span class="service-tool-pill"><i class="fa-solid fa-location-crosshairs"></i>{{ city }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>
      <div class="col-lg-6">
        <div class="service-visual-panel h-100 reveal-right">
          <div class="service-panel-head">
            <h2><i class="fa-solid fa-shield-halved"></i> Governance Alignment</h2>
            <p>Delivery model built around security, accountability, and measurable outcomes.</p>
          </div>
          <ul class="service-value-list mb-0">
            {% for item in compliance_frameworks %}
            <li><i class="fa-solid fa-circle-check"></i>{{ item }}</li>
            {% endfor %}
            {% for point in proof_points %}
            <li><i class="fa-solid fa-bullseye"></i><strong>{{ point.label }}:</strong> {{ point.value }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>
{% endif %}

<div class="glow-line"></div>

{% if tool_stack %}
<section class="section">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-layer-group"></i> Tools &amp; Platforms</div>
      <h2>Technology We Use</h2>
    </div>
    <div class="row g-4">
      {% set tool_colors = ['blue', 'purple', 'green', 'amber', 'rose', 'cyan'] %}
      {% for tool in tool_stack %}
      <div class="col-md-6">
        <div class="feature-item reveal stagger-{{ loop.index }}">
          <div class="fi-icon {{ tool_colors[(loop.index0) % 6] }}"><i class="{{ tool.icon }}"></i></div>
          <div>
            <h4>{{ tool.name }}</h4>
            {% if tool.desc %}<p>{{ tool.desc }}</p>{% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{% if related_services %}
<section class="section section--alt">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-arrows-split-up-and-left"></i> Related Services</div>
      <h2>Build a Full Coverage IT Stack</h2>
    </div>
    <div class="row g-4">
      {% set rel_colors = ['blue', 'purple', 'green', 'amber', 'rose', 'cyan'] %}
      {% for rel in related_services %}
      <div class="col-md-6 col-lg-4">
        <a href="{{ url_for('main.service_detail', slug=rel.slug) }}" class="feature-item reveal stagger-{{ loop.index }} h-100 text-decoration-none">
          <div class="fi-icon {{ rel_colors[(loop.index0) % 6] }}"><i class="{{ rel.icon_class }}"></i></div>
          <div>
            <h4>{{ rel.title }}</h4>
            <p>{{ (rel.description or '')[:140] }}{% if rel.description and rel.description|length > 140 %}...{% endif %}</p>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{% if featured_industries %}
<section class="section">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-building"></i> Industry Coverage</div>
      <h2>Playbooks for Sector-Specific Environments</h2>
    </div>
    <div class="row g-4">
      {% set ind_colors = ['blue', 'purple', 'green', 'amber', 'rose', 'cyan'] %}
      {% for ind in featured_industries %}
      <div class="col-md-6 col-lg-4">
        <article class="industry-card reveal stagger-{{ loop.index }}">
          <div class="ind-icon {{ ind_colors[(loop.index0) % 6] }}"><i class="{{ ind.icon_class }}"></i></div>
          <h3>{{ ind.title }}</h3>
          <p>{{ (ind.description or '')[:140] }}{% if ind.description and ind.description|length > 140 %}...{% endif %}</p>
          <a class="ind-link" href="{{ url_for('main.industry_detail', slug=ind.slug) }}">See industry playbook <i class="fa-solid fa-arrow-right"></i></a>
        </article>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{% if related_posts %}
<section class="section section--alt">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-newspaper"></i> Expert Insights</div>
      <h2>Related Articles and Best Practices</h2>
    </div>
    <div class="row g-4">
      {% set post_colors = ['cyan', 'rose', 'amber'] %}
      {% for item in related_posts %}
      {% set blurb = item.excerpt if item.excerpt else (item.content | striptags) %}
      <div class="col-lg-4">
        <a href="{{ url_for('main.post', slug=item.slug) }}" class="feature-item reveal stagger-{{ loop.index }} h-100 text-decoration-none">
          <div class="fi-icon {{ post_colors[(loop.index0) % 3] }}"><i class="fa-solid fa-newspaper"></i></div>
          <div>
            <h4>{{ item.title }}</h4>
            <p>{{ blurb[:150] }}{% if blurb|length > 150 %}...{% endif %}</p>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{% if faqs %}
<section class="section">
  <div class="container">
    <div class="section-heading text-center reveal">
      <div class="section-label"><i class="fa-solid fa-circle-question"></i> FAQ</div>
      <h2>Frequently Asked Questions</h2>
    </div>
    <div class="service-faq-list reveal">
      {% for faq in faqs %}
      <details class="service-faq-item" {% if loop.first %}open{% endif %}>
        <summary>{{ faq.q }}</summary>
        <p>{{ faq.a }}</p>
      </details>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<section class="section-sm section-bottom-spacious">
  <div class="cta-section reveal-scale">
    <div class="cta-inner">
      <h2>Book a Free IT Assessment</h2>
      <p>Get a scoped plan for {{ service.title | lower }}, with clear priorities, timeline options, and next steps.</p>
      <div class="cta-actions cta-actions-dual">
        <a href="{{ url_for('main.request_quote') }}" class="btn btn-quote"><i class="fa-solid fa-file-invoice-dollar"></i> Request Assessment</a>
        <a href="{{ url_for('main.contact', subject='Service Consultation: ' ~ service.title) }}" class="btn btn-remote-support"><i class="fa-solid fa-paper-plane"></i> Send Message</a>
      </div>
    </div>
  </div>
</section>
{% endblock %}
